{% extends "dashboard/base_admin.html" %}

{% block title %}Flujo mensual{% endblock %}
{% block top_title %}ðŸ’° Flujo mensual{% endblock %}

{% block content %}

<div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-3">
  <div>
    <div class="text-muted small">Selecciona mes y aÃ±o</div>
  </div>

  <form method="get" class="d-flex flex-wrap gap-2">
    <div>
      <label class="form-label mb-1 small">AÃ±o</label>
      <input type="number" class="form-control" name="anio" value="{{ anio }}" min="2000" max="2100">
    </div>

    <div>
      <label class="form-label mb-1 small">Mes</label>
      <input type="number" class="form-control" name="mes" value="{{ mes }}" min="1" max="12">
    </div>

    <div class="d-grid" style="min-width:140px;">
      <label class="form-label mb-1 small">&nbsp;</label>
      <button class="btn btn-primary" type="submit">Aplicar</button>
    </div>
  </form>
</div>

<div class="row g-2 mb-3">
  <div class="col-12 col-md-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted small">Total ingresos</div>
        <div class="fs-4 fw-bold">{{ total_ingresos }}</div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted small">Total egresos</div>
        <div class="fs-4 fw-bold text-danger">{{ total_egresos }}</div>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="text-muted small">Balance</div>
        {% if balance >= 0 %}
          <div class="fs-4 fw-bold text-success">{{ balance }}</div>
        {% else %}
          <div class="fs-4 fw-bold text-danger">{{ balance }}</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="card shadow-sm mb-3">
  <div class="card-body">
    <div class="fw-bold mb-2">ðŸ“… Detalle del mes</div>

    <div class="row g-3">
      <div class="col-12 col-lg-6">
        <div class="fw-semibold mb-2">Ingresos</div>
        {% if ingresos_qs %}
          <div class="table-responsive">
            <table class="table table-sm table-striped mb-0">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Concepto</th>
                  <th class="text-end">Total</th>
                </tr>
              </thead>
              <tbody>
                {% for i in ingresos_qs %}
                  <tr>
                    <td>{{ i.fecha }}</td>
                    <td>{{ i.concepto }}</td>
                    <td class="text-end">{{ i.total }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">No hay ingresos en este mes.</div>
        {% endif %}
      </div>

      <div class="col-12 col-lg-6">
        <div class="fw-semibold mb-2">Egresos</div>
        {% if egresos_qs %}
          <div class="table-responsive">
            <table class="table table-sm table-striped mb-0">
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Insumo</th>
                  <th class="text-end">Total</th>
                </tr>
              </thead>
              <tbody>
                {% for e in egresos_qs %}
                  <tr>
                    <td>{{ e.fecha }}</td>
                    <td>{{ e.insumo }}</td>
                    <td class="text-end">{{ e.total }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-muted">No hay egresos en este mes.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- (Opcional) Si luego metemos grÃ¡fico con Chart.js, lo ponemos aquÃ­ -->

{% endblock %}
